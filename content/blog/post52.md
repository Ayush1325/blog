+++
title = "My Week in Code #21"
description = "Updates regarding PocketBeagle 2 examples and image building"
date = "2025-02-16T00:30:12+05:30"

[taxonomies]
tags = ["weekly-update", "beagleboard", "linux", "pocketbeagle2"]
+++

Hello everyone. Another typical week. Let's go over everything.

# BeagleBoard Image Builder

After much deliberation [last week](@/blog/post52.md), I decided to go ahead with trying to use [debos](https://github.com/go-debos/debos) for image generation. I was able to create [debos recipes](https://openbeagle.org/ayush1325/debos-recipes) for [BeagleY-AI](https://www.beagleboard.org/boards/beagley-ai) and [PocketBeagle 2](https://www.beagleboard.org/boards/pocketbeagle-2). However, the image generated by debos does not seem to boot on either board. More specifically, it does not seem like the soc is able to find the bootloader (u-boot) present in the `BOOT` partition.

I did cross-check everything with the current images, and the partitions seem to be in order. So not sure what is going on here. I also went through the `debos` source code to see how it was creating the partitions, but recreating it in normal shell scripts does seem to work as expected. I also tried generating empty images using debos and copying the boot partition to the appropriate partition, but still could not get it to work.

I have created an [issue](https://github.com/go-debos/debos/issues/535) regarding this, with some scripts that generate the image properly. Let's see if it can be resolved soon.

# PocketBeagle 2 Examples

Some work also went into cleaning up the current examples for PocketBeagle 2. I will be getting my [PocketBeagle 2](https://www.beagleboard.org/boards/pocketbeagle-2) and [TechLab Cape](https://www.beagleboard.org/boards/techlab) delivered by the end of the week, so hopefully, the examples will be greatly expanded in the upcoming weeks.

## Refactor Dependencies

The examples were pulling some unnecessary dependencies, so I removed most of them. Now, there are only 6 dependencies, which is always nice.

I have switched to [gpiod](https://crates.io/crates/gpiod) for GPIO handling. This is because I went through the source code of both [gpiod](https://crates.io/crates/gpiod) and [gpio-cdev](https://crates.io/crates/gpio-cdev), and felt that gpiod was superior. Additionally, gpiod supports both v1 and v2 of [GPIO Character Device Userspace API](https://docs.kernel.org/userspace-api/gpio/chardev.html), while `gpio-cdev` only supports v1.

I can always write any shim that might be required for interop with [embedded_hal](https://crates.io/crates/embedded-hal) myself.

## Add blinky ioctl example

I have also added a [blinky example](https://openbeagle.org/beagleboard/vsx-examples/-/merge_requests/6), that directly uses [GPIO Character Device Userspace API](https://docs.kernel.org/userspace-api/gpio/chardev.html) instead of gpiod library. This should help anyone curious peek behind the curtain and get an idea of how the GPIO libraries work behind the scenes.

I am also thinking of creating a blinky example that does not have any dependencies, although I am a bit unsure if it should be another example, or just do that in this example.

# Ending Thoughts

That is all for the week. Hopefully, this series will keep people updated about my work and attract potential contributors.

Consider [supporting me](@/pages/about.md) if you like my work.

# Helpful links

- [BeagleBoard](https://www.beagleboard.org/)
- [Pocketbeagle 2](https://www.beagleboard.org/boards/pocketbeagle-2)
- [PocketBeagle 2 Examples](https://openbeagle.org/beagleboard/vsx-examples)
- [debos recipies](https://openbeagle.org/ayush1325/debos-recipes)
